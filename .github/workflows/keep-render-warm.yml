name: Keep Render Backend Warm

on:
  schedule:
    # Ping toutes les 10 minutes (évite le freeze de 15 min de Render)
    - cron: "*/10 * * * *"

  # Permet de lancer manuellement le workflow
  workflow_dispatch:

jobs:
  ping-backend:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Backend Health Endpoint
        run: |
          echo "🏃 Ping du backend MerciLille..."

          # URL Render du backend MerciLille
          BACKEND_URL="https://backend-merci-lille.onrender.com"

          # Ping avec timeout de 30 secondes
          response=$(curl -s -w "%{http_code}" -m 30 "$BACKEND_URL/health" || echo "000")

          if [ "$response" = "200" ]; then
            echo "✅ Backend OK - Status: $response"
          else
            echo "⚠️  Backend response: $response"
            # On ne fait pas échouer le job, juste un avertissement
          fi

          echo "🕐 Ping effectué à $(date)"

      - name: Ping API Endpoints (optionnel)
        run: |
          echo "🔍 Test des endpoints principaux..."

          BACKEND_URL="https://backend-merci-lille.onrender.com"

          # Test endpoint events (public)
          events_response=$(curl -s -w "%{http_code}" -m 15 "$BACKEND_URL/api/events" || echo "000")
          echo "📅 Events endpoint: $events_response"

          echo "✨ Tests terminés"
